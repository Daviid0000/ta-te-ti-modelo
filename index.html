<!DOCTYPE html>
<html>
  <head>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>;
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>;
    <link rel="stylesheet" href="./style.css">
  </head>
  <body>
    <h1>Console Log for Ticky Tacky Toe Goodness</h1>
    <div class="table">
        <div id="casilla-1">
            
        </div>
          <div id="casilla-2"></div>
          <div id="casilla-3"></div>
          <div id="casilla-4"></div>
          <div id="casilla-5"></div>
          <div id="casilla-6"></div>
          <div id="casilla-7"></div>
          <div id="casilla-8"></div>
          <div id="casilla-9"></div>
        </div>
<script>
   document.addEventListener('DOMContentLoaded', () => {
        let tabla = Array(9).fill(0); // Inicializar tabla con ceros
        let isPlayerTurn = true; // Variable para controlar el turno del jugador

        const circulo = 'O';
        const equis = 'X';

        // Función para manejar el clic del jugador
        function handleCasillaClick(event) {
          const casilla = event.target;
          const casillaIndex = parseInt(casilla.id.split('-')[1]) - 1;

          if (tabla[casillaIndex] === 0 && isPlayerTurn) { // Verificar si la casilla está vacía
            casilla.textContent = circulo; // Mostrar el movimiento del jugador
            tabla[casillaIndex] = 1; // Actualizar la tabla con el movimiento del jugador
            isPlayerTurn = false; // Cambiar el turno
            console.log("Tabla actualizada:", tabla);

            // Aquí iría la llamada a la función para que el modelo prediga el siguiente movimiento
            predictWithModel();
          }
        }

        // Añadir event listener a cada casilla
        const casillas = document.querySelectorAll('.table div');
        casillas.forEach(casilla => {
          casilla.addEventListener('click', handleCasillaClick);
        });

        // Ejemplo de cómo podrías usar el array `tabla` para crear un tensor y predecir con el modelo de TensorFlow.js
        async function predictWithModel() {
          if (!isPlayerTurn) {
            tf.ready().then(async () => {
              const model = await tf.loadLayersModel('model/ttt_model.json');
              const tensorTabla = tf.tensor(tabla, [1, 9]);
              const result = model.predict(tensorTabla);
              const prediction = result.argMax(-1).dataSync()[0]; // Índice del mejor movimiento predicho

              tabla[prediction] = -1; // Actualizar la tabla con el movimiento del modelo
              document.getElementById(`casilla-${prediction + 1}`).textContent = equis; // Mostrar el movimiento del modelo

              isPlayerTurn = true; // Cambiar el turno de vuelta al jugador
              console.log("Tabla actualizada por el modelo:", tabla);
            });
          }
        }
      });
</script>
  </body>
</html>
